# package.json の scripts コマンド詳細ドキュメント

本ドキュメントでは、プロジェクトの `package.json` に定義された各種 npm scripts の責務・動作内容について、一切省略せず詳細かつ具体的に解説します。
開発・テスト・CI/CD・品質管理の各フェーズで、どのコマンドがどのような役割を果たすのかを明確にし、チーム全体での運用・理解を促進します。

---

## 1. 開発・ビルド・起動関連

### `"dev": "next dev"`

-   **責務**: 開発用サーバーの起動
-   **動作**:
    -   Next.js の開発サーバーを起動し、`localhost:3000` などでアプリをホットリロード付きで動作させます。
    -   コードの変更を即時反映し、開発効率を向上させます。
-   **主な用途**: 開発時のローカル動作確認

---

### `"build": "next build"`

-   **責務**: 本番用ビルドの生成
-   **動作**:
    -   Next.js アプリケーションを本番環境向けに最適化してビルドします。
    -   静的ファイルやサーバーサイドレンダリング用のコードを生成します。
    -   型チェックやビルドエラーがあれば失敗します。
-   **主な用途**: 本番デプロイ前のビルド、CI/CD でのビルド検証

---

### `"start": "next start"`

-   **責務**: 本番サーバーの起動
-   **動作**:
    -   `next build` で生成された成果物を用いて、Next.js の本番サーバーを起動します。
    -   実際の運用環境や本番検証で利用します。
-   **主な用途**: 本番環境・ステージング環境でのサービス起動

---

## 2. コード品質・整形関連

### `"lint": "next lint"`

-   **責務**: 静的解析によるコード品質チェック
-   **動作**:
    -   ESLint を実行し、ソースコード内の構文エラーやコーディング規約違反を検出します。
    -   Next.js 標準の ESLint 設定が反映されます。
-   **主な用途**: プルリクエスト前の品質チェック、CI での自動検証

---

### `"lint:fix": "next lint --fix"`

-   **責務**: コード品質の自動修正
-   **動作**:
    -   ESLint の自動修正機能により、修正可能な警告やエラーを自動で修正します。
    -   手動で修正する手間を減らし、統一されたコードスタイルを維持します。
-   **主な用途**: コード修正時の自動整形、コミット前のクリーンアップ

---

### `"format": "prettier --write \"src/**/*.ts\" \"src/**/*.tsx\""`

-   **責務**: コード整形（自動フォーマット）
-   **動作**:
    -   Prettier を使い、`src/` ディレクトリ配下の `.ts` および `.tsx` ファイルを自動で整形します。
    -   コードの見た目やスタイルを統一し、可読性を向上させます。
-   **主な用途**: 開発中・コミット前のコードフォーマット

---

### `"format:check": "prettier --check \"src/**/*.ts\" \"src/**/*.tsx\""`

-   **責務**: コード整形状態の検証
-   **動作**:
    -   Prettier で整形済みかどうかをチェックします（実際の書き換えは行わない）。
    -   フォーマットが崩れているファイルがあればエラーを返します。
-   **主な用途**: CI での自動チェック、pre-commit フックでの検証

---

## 3. テスト関連

### `"test": "jest"`

-   **責務**: ユニット・統合テストの実行
-   **動作**:
    -   Jest により、テストファイル（例: `*.test.ts`, `*.test.tsx`）を全て実行します。
    -   テストの成否、カバレッジなどを出力します。
-   **主な用途**: 開発中や CI での基本的なテスト実行

---

### `"test:watch": "jest --watch"`

-   **責務**: テストのウォッチモード実行
-   **動作**:
    -   ファイルの変更を監視し、変更があったテストのみを自動で再実行します。
    -   開発中のテスト駆動開発（TDD）やデバッグに便利です。
-   **主な用途**: 開発中のリアルタイムテスト

---

### `"test:ci": "jest --ci"`

-   **責務**: CI/CD 環境向けのテスト実行
-   **動作**:
    -   Jest の CI モードでテストを実行します。
    -   インタラクティブな入力を無効化し、安定した出力を保証します。
    -   テスト失敗時は非ゼロ終了コードを返し、パイプラインを停止させます。
-   **主な用途**: GitHub Actions など CI/CD パイプラインでの自動テスト

---

### `"test:e2e": "playwright test"`

-   **責務**: エンドツーエンド（E2E）テストの実行
-   **動作**:
    -   Playwright により、`e2e/` ディレクトリ等に配置した E2E テストスクリプトを全て実行します。
    -   複数ブラウザ（Chromium, Firefox, WebKit）での自動操作・検証を行います。
-   **主な用途**: 本番同等環境でのユーザー操作シナリオ検証、回帰テスト

---

### `"test:e2e:ui": "playwright test --ui"`

-   **責務**: Playwright のインタラクティブ UI での E2E テスト実行
-   **動作**:
    -   Playwright Test Runner の GUI（グラフィカルユーザーインターフェース）を起動します。
    -   テストケースの一覧表示、個別実行、ステップごとのデバッグ・動画やトレースの確認が可能です。
-   **主な用途**: テストシナリオのデバッグ、テスト実行状況の可視化

---

## 4. コミット前フック

### `"pre-commit": "npm run lint && npm run format:check && npm run test:ci"`

-   **責務**: コミット前の自動品質チェック
-   **動作**:
    1. `npm run lint` で静的解析（ESLint）を実行
    2. `npm run format:check` でコードフォーマットが正しいか検証
    3. `npm run test:ci` で全テストを CI モードで実行
    -   いずれかでエラーが発生した場合、コミットは中断されます。
-   **主な用途**: コード品質の担保、未整形・未検証コードのコミット防止

---

## 5. 補足

-   **scripts の活用方法**:
    -   コマンドは単独でも、組み合わせても実行可能です。
    -   Husky などのツールと連携し、Git のフックとして `pre-commit` を自動実行する運用が一般的です。
-   **カスタマイズ**:
    -   ディレクトリ構成やプロジェクト要件に応じて、コマンド内容や対象ファイルパターンは適宜調整してください。

---

> 本ドキュメントは、プロジェクトの開発・運用・品質管理を円滑に進めるため、各 npm scripts の責務と動作内容を完全に網羅しています。新規メンバーのオンボーディングや運用ルールの明確化にご活用ください。
